# Travelify - Conversational AI Travel Planning Platform

## Project Overview
A conversational AI travel planning platform that creates personalized travel packages through guided dialogue and real-time POI integration. Users interact with an AI through chat to clarify their travel preferences, then receive 3 customized travel package options with interactive day-by-day itineraries.

## Key Features
- Chat-based conversational interface (2-3 guided questions)
- Real-time travel package generation (A/B/C options)
- Google Places API integration for authentic POI data
- Interactive dashboard with package comparison
- Day-by-day itinerary with minimal editing capabilities
- JSON export for travel agency handoff
- Package refinement through conversation continuation

## User Preferences
- Focus on authentic data over mock/placeholder content
- Emphasize conversational flow over form-based input
- Prioritize user experience with interactive dashboard
- Keep conversation guided but natural

## Project Architecture
- Frontend: React with Wouter routing, TanStack Query for data management
- Backend: Express.js with in-memory storage
- Styling: Tailwind CSS with purple/gold color scheme (#2D1B69, #FFD700)
- External APIs: Google Places API for POI data
- Data Flow: Chat → Clarification → Package Generation → Dashboard → Export
- Data Integrity: Session-scoped tag processing, quarantined candidate logging, safety filters
- Security: Input validation, content filtering, rate limiting, no auto-persistence of user text

## Recent Changes
- 2025-01-27: **Intelligent Itinerary Generation with Realistic Duration Estimates:**
  - Implemented AI-powered itinerary builder that considers actual visit durations
  - Added duration estimation based on POI types (theme parks: 8hrs, museums: 2-3hrs, etc.)
  - Integrated OpenAI GPT-4 to reason about feasible daily combinations
  - Prevents unrealistic groupings (e.g., Disneyland + Tokyo Tower on same day)
  - Distributes attractions intelligently across all days based on duration and travel time
  - Maximum 8 hours of activities per day with proper time slot allocation
  - Considers travel time between locations (30 min average)
  - Groups nearby attractions to minimize transit
  - Balances each day with varied activity types (culture, food, shopping)
  - Fallback algorithm ensures itinerary generation even if AI service fails
- 2025-01-26: **Auto-Navigation and Improved User Flow:**
  - Implemented automatic navigation from Chat to Package Selection after AI generates 3 packages
  - Created proper routing structure: `/chat`, `/packages`, `/itinerary/:id`
  - Added Zustand store for package state management across pages
  - Implemented breadcrumb navigation for easy navigation between pages
  - Added smooth page transitions with fade/slide animations (200-300ms)
  - Mobile-optimized with toast notifications when packages are ready
  - Deep link support - users can directly access `/packages` and `/itinerary/:id`
  - Session-based package persistence - packages remain until new session starts
  - Made package cards fully clickable for direct navigation to itinerary detail
  - Auto-scroll to top on page transitions for better mobile UX
- 2025-01-26: **Session-Scoped Personalization System:**
  - Implemented SessionManager service with 4-hour TTL for temporary preference storage
  - Created session middleware for Express with cookie/header-based session tracking
  - Built SessionEnhancedPackageGenerator that applies personalization weights (≤30% boost)
  - Added session ID tracking to API client via X-Session-Id headers
  - Formula: Output = Global baseline × Session-specific weights (0.7 to 1.3 range)
  - Session preferences never persist to global database, only verified Google Places POIs
  - Free-text inputs (e.g., "play water", "burgers") only affect ranking within session
  - Automatic session cleanup every 15 minutes for expired sessions
  - Frontend localStorage tracking with automatic session renewal
- 2025-01-26: **Enhanced POI Search with LLM Ranking:**
  - Implemented Google Places search with city/context scoping
  - Added LLM ranking to filter and show top 5 best results
  - 500ms debounced auto-search as you type
  - Enhanced UI with star ratings, review counts (13.7k format), and price levels ($$$)
  - Category badges with color coding (red for food, blue for attractions, etc.)
  - "Search wider radius" fallback for no results
- 2025-01-26: **Enhanced Itinerary Card UI:**
  - Replaced text-based ratings with visual star component (with half-star support)
  - Added formatted review counts with lighter gray color (#CCCCCC) and K formatting (e.g., 1.5k)
  - Implemented colored pill-shaped category tags (red for food, blue for attractions, green for nature, etc.)
  - Improved information hierarchy with bold titles, secondary ratings, and smaller description text
  - Added StarRating component for reusable visual rating display
  - Enhanced activity type detection with expanded categories (food, culture, nature, shopping, nightlife)
  - Icons now have category-specific colors (red for food, purple for accommodation, blue for attractions)
- 2025-01-26: **Fixed Free-Text Preference Handling:**
  - Free-text preferences from chat (e.g., "play water") now properly influence itinerary generation
  - Added extraction of preferences from conversation messages (water, food, culture, nature, etc.)
  - Merged free-text with selected tags for equal weight in POI scoring
  - Added search query mappings for free-text terms (water activities → water parks, onsen, beaches)
  - Cities without curated tags (like Sapporo) now respect user intent from chat
  - System processes both `selectedTags` and `freeTextPreferences` arrays
  - Fixed itinerary generation to maintain 4-5 activities consistently across all days
- 2025-01-26: **Implemented Data Integrity Policy:**
  - Session-scoped tag processing (never persisted to canonical DB)
  - Created `userTagCandidates` quarantined table with 30-day TTL for review
  - Added safety filters to block inappropriate/suspicious content
  - Free-text only biases POI selection, never creates permanent tags
  - Human review required before promoting candidates to official tags
  - Comprehensive input validation and sanitization
  - Rate limiting and content filtering for POIs
- 2025-08-19: Initial project setup with conversational travel planning concept
- Removed budget breakdown and accommodation suggestions from scope
- Focused on core conversational experience and POI integration
- 2025-08-20: Enhanced chat experience with major improvements:
  - Added city-level destination support (recognizes both countries and cities)
  - Implemented fuzzy matching for typos (e.g., "lodon" → London, "kioto" → Kyoto)
  - Natural number parsing (accepts "five days" and "5 days")
  - Auto-focus on chat input after messages
  - Country → City flow (suggests 4-5 popular cities when country selected)
  - More conversational, less form-like dialogue
  - Graceful error recovery without freezing
  - Fixed redundant people count confirmation - typing "3" immediately proceeds
  - Expanded city database to 30+ countries with 5-10 major cities each
  - Cities not in curated list (like Okinawa) are now accepted without resetting
  - Context-aware number interpretation based on conversation step
  - Fixed critical city matching bug - "Dallas" no longer incorrectly matches to "Los Angeles"
  - Removed problematic partial string matching that caused false positives
  - Cities are now accepted exactly as typed when not in curated list
- 2025-08-21: Implemented comprehensive city database with Google Places integration:
  - Created PostgreSQL database structure with cities, conversations, packages, and POIs tables
  - Seeded 138 curated cities across 26 countries with Google Place IDs
  - Japan includes all requested cities: Tokyo, Osaka, Kyoto, Okinawa, Sapporo, Fukuoka, Nagoya, Yokohama
  - Built CityService with database operations and Google Places validation capability
  - Implemented city API routes for search and popular cities retrieval
  - Database stores canonical Google Place IDs for each city for future enrichment
  - Cities marked as "curated" with popularity scores for better recommendations
  - Added Google Maps deep links to all POIs using Place IDs
  - Implemented actionable navigation buttons with format: https://www.google.com/maps/place/?q=place_id:<PLACE_ID>
  - Added Maps links in both itinerary view and POI search modal for preview
  - Fallback to search query links for POIs without Place IDs
  - **Replaced generic theme question with localized city-specific tags:**
    - Dynamic multi-select tag interface based on selected city
    - 40+ major cities with curated popular attractions (Tokyo → Disneyland, Tokyo Tower, etc.)
    - Support for custom user preferences alongside predefined tags
    - Tags appear naturally in conversation as if typed by user
    - Fallback to generic interests for non-curated cities
- 2025-01-25: **Enhanced Tag System with Advanced Normalization:**
  - **Database Schema**: Added cityTags, tagAliases, tagEmbeddings, userTagSelections tables
  - **Multi-lingual Support**: Japanese/English aliases (e.g., "築地" → Tsukiji Market, "TDL" → Tokyo Disneyland)
  - **Fuzzy Matching**: Handles typos with Levenshtein distance (≥75% similarity threshold)
  - **Tag Normalization Service**: Maps free-text inputs to existing tags or creates validated candidates
  - **Enhanced Storage**: 10+ tags for Tokyo, 5+ for Kyoto/Osaka with aliases
  - **Smart Categorization**: Tags grouped by category (attraction, district, experience, food)
  - **Usage Tracking**: Increments scores based on user selections for better recommendations
  - **Real-time Search**: As-you-type tag suggestions with confidence scores
  - **Google Places Validation**: Future-ready for validating unknown tags via Places API
  - **EnhancedTagSelector Component**: Visual categories, multi-select, custom input support
  - **Country Alias Normalization**: "America", "United States", "U.S." all map to "USA" correctly
  - **Expanded City Coverage**: Added comprehensive tags for 8 major US cities (New York, Los Angeles, Las Vegas, San Francisco, Miami)
  - **Universal Tag Support**: All supported destinations now show relevant tags (no longer limited to Japan)
  - **Fallback Mechanism**: Cities without specific tags show generic interests (Must-see Highlights, Local Food & Culture, etc.)
- 2025-01-26: **Enhanced Itinerary Generation with Tag Support:**
  - **Comprehensive City Database**: Seeded 39 major cities across 17 countries with curated tags
  - **Tag-Driven POI Selection**: Created enhancedPackageGenerator service that respects user-selected tags
  - **Real Google Places Integration**: All POIs have valid Place IDs and ratings from Google Places API
  - **Balanced Itinerary Generation**: Each day includes 1-2 tag-related POIs plus must-see attractions
  - **Multi-lingual Tag Support**: Tags include native language aliases (Japanese, Korean, Thai, Chinese, Arabic, Greek)
  - **Quality Filters**: POIs filtered by minimum rating (4.0+) and review count (100+)
  - **Tag Coverage Validation**: System ensures each selected tag appears at least once in itinerary
  - **Smart POI Categorization**: Automatic categorization of venues (food, culture, shopping, nightlife, nature)
  - **Explanations for POI Selection**: Each POI includes reason tied to tag or popularity
  - **Three Package Types**: Classic (tag-focused), Foodie (culinary), and Budget options

## Technical Stack
- Full-stack JavaScript with TypeScript
- Drizzle ORM with in-memory storage
- shadcn/ui components
- Google Places API integration
- Export functionality for JSON handoff

## Development Status
- Setting up: Data models, conversational interface, Google Places integration
- Next: Package generation, dashboard, and editing features